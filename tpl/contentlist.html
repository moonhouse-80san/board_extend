<!--%import("./css/buttonset.css")-->
<!--%import("./js/modify_document.js")-->
<!--#include("header.html")-->

<h4>ìˆœì„œë³€ê²½ ê¸°ëŠ¥ì€, ë¬¸ì„œì¶œë ¥ ìˆœì„œì„¤ì •ì´ "ë¬¸ì„œë²ˆí˜¸" "ë‚´ë¦¼ì°¨ìˆœ"ì¸ê²½ìš°ì—ë§Œ ë™ì‘í•˜ê³ , ë‹¤ë¥¸í˜ì´ì§€ì˜ ë¬¸ì„œì™€ ìœ„ì¹˜ê°€ ë³€ê²½ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h4>
<p>DBì— ì ‘ê·¼í•˜ì§€ì•Šê³ ì„œ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•œ ë¶€ë¶„ì„ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.</p>

<!--// í—ˆìš© í™•ì¥ì ì²´í¬ë°•ìŠ¤ UI -->
<details style="display:inline-block; background-color:#444; padding:4px 6px; border:1px solid #e0e0e0; border-radius:4px; min-width:730px;">
	<summary style="color:#fff;">ë‹¤ìš´ë¡œë“œ ìˆ˜ ë³€ê²½ë€ì— í—ˆìš©í•  ì²¨ë¶€íŒŒì¼ í™•ì¥ìë¥¼ ì„ íƒì‹œ <span style="color:gold; font-weight:bold;">Click !!</span> <span style="font-size:10px; color:#eee; float:right;">( ê¸°ë³¸ì„¤ì •ì€ ë¯¸ë””ì–´ íŒŒì¼ ì œì™¸ ëª¨ë“  íŒŒì¼ í—ˆìš© )</span></summary>
	<div style="display:inline-block; margin:5px 0 2px; padding:10px; background:#f8f9fa; border:1px dotted #ddd; border-radius:4px;">

		<!-- ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì¶”ê°€ -->
		<div style="margin-bottom:10px; padding-bottom:8px; border-bottom:1px solid #ddd;">
			<label style="cursor:pointer; font-weight:bold;">
				<input type="checkbox" id="selectAllAllowed" onclick="toggleAllExtensions(this, 'allowed')" />
				ì „ì²´ ì„ íƒ/í•´ì œ (ìµœìš°ì„  ì ìš©)
			</label>
		</div>

		<div id="extensionList" style="display:flex; flex-wrap:wrap; gap:12px; font-size:12px;">
			{@ $default_exts = array('zip','exe','txt','html','pdf','hwp','hwpx','doc','docx','xls','xlsx','ppt','pptx') }
			{@ $saved_exts = array() }
			{@ $saved_ext_string = isset($allowed_extensions) ? $allowed_extensions : '' }
			<!--@if(!empty($saved_ext_string))-->
				{@ $saved_exts = array_map('trim', explode(',', $saved_ext_string)) }
			<!--@end-->
			<!--@foreach($default_exts as $ext)-->
				<label style="cursor:pointer;">
					<input type="checkbox"
						   class="ext-checkbox"
						   name="allowed_extensions[]"
						   value="{$ext}"
						   onclick="updateSelectAllState('allowed')"
						   <!--@if(in_array($ext, $saved_exts))-->checked<!--@end--> />
					.{$ext}
				</label>
			<!--@end-->
		</div>

		<!-- í™•ì¥ì ì§ì ‘ ì¶”ê°€ UI -->
		<div style="margin-top:12px; padding-top:12px; border-top:1px solid #ddd;">
			<div style="display:flex; align-items:center; gap:8px;">
				<label style="font-size:12px; font-weight:bold;">í™•ì¥ì ì¶”ê°€:</label>
				<input type="text" id="customExtension" placeholder="ê²Œì‹œíŒ íŠ¹ì§•ì— ë”°ë¼ì„œ ì˜ˆ: psd, rarë“±" style="flex:1; height:30px; padding:0 10px; font-size:12px; border:1px solid #ddd; border-radius:3px; box-sizing:border-box;" onkeypress="if(event.keyCode==13){addCustomExtension('allowed'); return false;}" />
				<button type="button" onclick="addCustomExtension('allowed'); return false;" style="height:30px; padding:0 15px; background:#5c7cfa; color:#fff; border:none; border-radius:3px; cursor:pointer; font-size:12px; white-space:nowrap; margin-top:-10px;">ì¶”ê°€</button>
			</div>
			<p style="margin-top:4px; font-size:10px; color:#999;">
				â€» ì—¬ëŸ¬ ê°œ ì¶”ê°€ ì‹œ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•´ì£¼ì„¸ìš”. ì˜ˆ: psd, dwg, css, rar 
			</p>
		</div>

		<p style="margin-top:6px; font-size:11px; color:#777;">
			ì²´í¬ëœ í™•ì¥ìë§Œ ìµœìš°ì„  ë‹¤ìš´ë¡œë“œ ëª©ë¡ì— í‘œì‹œë©ë‹ˆë‹¤. (ì²´í¬ ì•ˆí•˜ë©´ <u>ë¯¸ë””ì–´ í™•ì¥ìê°€ í¬í•¨ë˜ì§€ ì•Šì€</u> ëª¨ë“  í™•ì¥ìê°€ í‘œì‹œë©ë‹ˆë‹¤.)
		</p>
		<div style="margin-top:10px; float:right;">
			<input type="button" value="í™•ì¥ì ì„¤ì • ì €ì¥" onclick="saveExtensionSettings('allowed')" style="height:30px; padding:0 15px; background:#333; color:#fff; border:none; border-radius:3px; cursor:pointer;" />
		</div>

		<!--// ë¯¸ë””ì–´ íŒŒì¼ ì œì™¸ ì²´í¬ë°•ìŠ¤ -->
		<div style="display:inline-block; margin-bottom:5px; padding:8px 12px; border:1px solid #e0e0e0; border-radius:4px; background:#fff; float:left;">
			<label style="cursor:pointer; font-size:13px; display:flex; align-items:center; gap:6px;">
				<input type="checkbox" 
					   id="excludeMedia" 
					   name="exclude_media" 
					   value="Y"
					   onchange="toggleMediaFilter(this)"
					   <!--@if($exclude_media == 'Y' || !$exclude_media)-->checked<!--@end--> />
				<span style="font-weight:bold;">ë¯¸ë””ì–´ íŒŒì¼ ì œì™¸ (ì‚¬ì§„, ë™ì˜ìƒ, ìŒì•… ë“±)</span>
			</label>
			<p id="excludeMediaDesc" style="margin:4px 0 0 24px; font-size:12px; color:#999; display:<!--@if($exclude_media == 'Y' || !$exclude_media)-->block<!--@else-->none<!--@end-->;">
				ì²´í¬ í•´ì œ ì‹œ ë¯¸ë””ì–´ í™•ì¥ìë¥¼ ê°œë³„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
				í—ˆìš©í•  í™•ì¥ì ê°œë³„ ì²´í¬ì‹œ ì²´í¬í•œ í™•ì¥ìë§Œ ì¶œë ¥ë©ë‹ˆë‹¤.
			</p>
		</div>

		<!-- ë¯¸ë””ì–´ íŒŒì¼ ê°œë³„ ì„ íƒ ì„¹ì…˜ (í† ê¸€) -->
		<div id="mediaExtensionSection" style="clear:both; margin-top:15px; padding:15px; background:#fff5f5; border:1px solid #ffcccc; border-radius:4px; display:<!--@if($exclude_media != 'Y' && $exclude_media !== null && $exclude_media !== '')-->block<!--@else-->none<!--@end-->;">
			<!-- ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ -->
			<div style="margin-bottom:10px;">
				<label style="cursor:pointer; font-weight:bold;">
					<input type="checkbox" id="selectAllMedia" onclick="toggleAllExtensions(this, 'media')" />
					ë¯¸ë””ì–´ ì „ì²´ ì„ íƒ/í•´ì œ
				</label>
			</div>

			<!-- ì´ë¯¸ì§€ íŒŒì¼ -->
			<div style="margin-bottom:12px;">
				<strong style="color:#6c5ce7; font-size:13px;">ğŸ“· ì´ë¯¸ì§€ íŒŒì¼</strong>
				<div style="display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; font-size:12px; padding-left:20px;">
					{@ $image_exts = array('jpg','jpeg','png','gif','bmp','webp','svg','ico','tiff','tif') }
					{@ $excluded_media = array() }
					{@ $excluded_media_string = Context::get('excluded_media_extensions') ?: '' }
					<!--@if(!empty($excluded_media_string))-->
						{@ $excluded_media = array_map('trim', explode(',', $excluded_media_string)) }
					<!--@end-->
					<!--@foreach($image_exts as $ext)-->
						<label style="cursor:pointer;">
							<input type="checkbox"
								   class="media-checkbox"
								   name="excluded_media_extensions[]"
								   value="{$ext}"
								   onclick="updateSelectAllState('media')"
								   <!--@if(!in_array($ext, $excluded_media))-->checked<!--@end--> />
							.{$ext}
						</label>
					<!--@end-->
				</div>
			</div>

			<!-- ë™ì˜ìƒ íŒŒì¼ -->
			<div style="margin-bottom:12px;">
				<strong style="color:#0984e3; font-size:13px;">ğŸ¬ ë™ì˜ìƒ íŒŒì¼</strong>
				<div style="display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; font-size:12px; padding-left:20px;">
					{@ $video_exts = array('mp4','avi','mov','wmv','flv','mkv','webm','mpeg','mpg','m4v','3gp') }
					<!--@foreach($video_exts as $ext)-->
						<label style="cursor:pointer;">
							<input type="checkbox"
								   class="media-checkbox"
								   name="excluded_media_extensions[]"
								   value="{$ext}"
								   onclick="updateSelectAllState('media')"
								   <!--@if(!in_array($ext, $excluded_media))-->checked<!--@end--> />
							.{$ext}
						</label>
					<!--@end-->
				</div>
			</div>

			<!-- ìŒì•… íŒŒì¼ -->
			<div style="margin-bottom:12px;">
				<strong style="color:#00b894; font-size:13px;">ğŸµ ìŒì•… íŒŒì¼</strong>
				<div style="display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; font-size:12px; padding-left:20px;">
					{@ $audio_exts = array('mp3','wav','ogg','flac','aac','m4a','wma','ape','alac') }
					<!--@foreach($audio_exts as $ext)-->
						<label style="cursor:pointer;">
							<input type="checkbox"
								   class="media-checkbox"
								   name="excluded_media_extensions[]"
								   value="{$ext}"
								   onclick="updateSelectAllState('media')"
								   <!--@if(!in_array($ext, $excluded_media))-->checked<!--@end--> />
							.{$ext}
						</label>
					<!--@end-->
				</div>
			</div>

			<p style="margin-top:10px; font-size:11px; color:#999; background:#fff; padding:8px; border-left:3px solid #d63031;">
				âœ… ì²´í¬ëœ ë¯¸ë””ì–´ íŒŒì¼ë§Œ ë‹¤ìš´ë¡œë“œ ëª©ë¡ì— í‘œì‹œë©ë‹ˆë‹¤.<br/>
				âŒ <u>ì²´í¬ í•´ì œí•œ ë¯¸ë””ì–´ íŒŒì¼ì€ ì¶œë ¥ì—ì„œ ì œì™¸</u>ë©ë‹ˆë‹¤.
			</p>

			<div style="margin-top:10px; text-align:right;">
				<input type="button" value="ë¯¸ë””ì–´ íŒŒì¼ ì„¤ì • ì €ì¥" onclick="saveMediaSettings()" style="height:30px; padding:0 15px; background:#d63031; color:#fff; border:none; border-radius:3px; cursor:pointer;" />
			</div>
		</div>
	</div>
</details>

<table border="0" cellspacing="0" summary="" class="rowTable">
	<caption>í•œë²ˆì— ë³¼ ë¬¸ì„œê°¯ìˆ˜ : <input type="text" name="list_count" value="{$list_count}" style="margin-top:5px;"/>
	<input type="button" style="height:26px; line-height:26px; padding:0 10px; font-size:11px; box-sizing:border-box; vertical-align:middle; margin-top:-5px;" value="ì ìš©" onclick="document.location.href = current_url.setQuery('list_count',jQuery(this).prev().val());" /></caption>
	<thead>
	<tr>
		<th>ë²ˆí˜¸</th>
		<th>ì œëª©</th>
		<th>ì¡°íšŒìˆ˜</th>
		<th>ì¶”ì²œìˆ˜</th>
		<th>ì‘ì„±ì¼ (yyyymmddhhiiss)</th>
		<th>ìˆ˜ì •ì¼ (yyyymmddhhiiss)</th>
		<th>ìˆœì„œë²ˆí˜¸</th>
		<th>ë°˜ì˜</th>
		<th>ë‹¤ìš´ë¡œë“œ ìˆ˜</th>
	</tr>
	</thead>
	<tbody>
	<!--// ê²Œì‹œë¬¼ì´ ì—†ìœ¼ë©´ ë“±ë¡ëœ ê¸€ì´ ì—†ìŒì„ í‘œì‹œ -->
	<!--@if(!$document_list)-->
	<tr class="bg0 tCenter">
		<td colspan="9" class="title">
			ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
		</td>
	</tr>
	<!--@else-->
		{@ $first=true}
		<!--// ì¼ë°˜ ê¸€ ì¶œë ¥ -->
		<!--@foreach($document_list as $no => $document)-->
		<tr class="bg{($no+1)%2+1}" style="border:1px solid #e0e0e0;<!--@if($document_srl == $document->document_srl)-->background-color:#ddd;<!--@end-->">
			<td class="num" style="padding-left:10px;"><!--@if($document_srl == $document->document_srl)--><img src="images/iconArrowD8.gif" border="0" alt="" /><!--@else-->{$no}<!--@end--></td>
			<td class="title">
				<!--@if($grant->manager)-->
					<!--@if($no!=1)-->
					<a href="#" onclick="moveDocument('{$document->document_srl}','down','{$no}'); return false;" class="buttonSet buttonDown"><span>ì•„ë˜ë¡œ</span></a>
					<!--@end-->
					<!--@if($first==false)-->
						<a href="#" onclick="moveDocument('{$document->document_srl}','up','{$no}'); return false;" class="buttonSet buttonUp"><span>ìœ„ë¡œ</span></a>
					<!--@else-->
						{@ $first=false}
					<!--@end-->
				<!--@end-->
				<a href="{getUrl('document_srl',$document->document_srl, 'listStyle', $listStyle, 'cpage','')}">{$document->getTitle($module_info->subject_cut_size)}</a>{$document->printExtraImages(60*60*$module_info->duration_new)}
			</td>
			<td class="reading"><input type="text" style="width:50px;" class="readed_count_{$document->document_srl}" value="{$document->get('readed_count')}" /></td>
			<td class="recommend"><input type="text" style="width:50px;" class="voted_count_{$document->document_srl}" value="{$document->get('voted_count')}" /></td>
			<td class="date"><input type="text" style="width:120px;" class="regdate_{$document->document_srl}" value="{$document->get('regdate')}" /></td>
			<td class="date"><input type="text" style="width:120px;" class="last_update_{$document->document_srl}" value="{$document->get('last_update')}" /></td>
			<td><input type="text" style="width:80px;" class="list_order_{$document->document_srl}" list_order="{$document->get('list_order')}" id="{$no}_order" value="{$document->get('list_order')}" /></td>
			<td style="padding-left:10px"><span class="btn" style="margin-top:-8px;"><input type="button" style="height:26px; line-height:26px; padding:0 10px; font-size:11px; box-sizing:border-box; vertical-align:middle;" onclick="applyModify('{$document->document_srl}')" value="ìˆ˜ì •ë°˜ì˜" /></span></td>

			<!-- ë‹¤ìš´ë¡œë“œ ìˆ˜ ì»¬ëŸ¼ -->
			<td style="padding:10px 10px 0 10px;">
				<!--@if($document->uploaded_files && count($document->uploaded_files) > 0)-->
					<!--@foreach($document->uploaded_files as $idx => $file)-->
						<div style="margin-bottom:8px; padding:5px; background:#f9f9f9; border-radius:3px; border:1px solid #e0e0e0;">
							<div style="margin-bottom:3px; font-size:12px;">
								ğŸ“ <strong>{$file->source_filename}</strong>
							</div>
							<div style="padding-left:15px; font-size:11px; display:inline-flex; align-items:center; gap:6px;">
								í˜„ì¬: <span style="color:#666;">{$file->download_count}íšŒ</span>
								â†’
								<input type="number" id="download_{$file->file_srl}" value="{$file->download_count}" min="0" style="width:60px; height:26px; line-height:26px; margin-top:10px; padding:10px 6px; font-size:11px; border:1px solid #ddd; border-radius:3px; box-sizing:border-box; vertical-align:middle;" />
								<button type="button" onclick="updateDownloadCount('{$file->file_srl}')" style="height:26px; line-height:26px; padding:0 10px; font-size:11px; cursor:pointer; background:#5c7cfa; color:white; border:none; border-radius:3px; box-sizing:border-box; vertical-align:middle;">ë³€ê²½</button>
							</div>
						</div>
					<!--@end-->
				<!--@else-->
					<span style="color:#999; font-size:11px;">ë³€ê²½í•  íŒŒì¼ ì—†ìŒ</span>
				<!--@end-->
			</td>
		</tr>
		<!--@end-->
	<!--@end-->
	</tbody>
</table>

<div class="pagination a1">
	<a href="{getUrl('page','','document_srl','','division',$division,'last_division',$last_division,'entry','')}" class="prevEnd">{$lang->first_page}</a> 
	<!--@while($page_no = $page_navigation->getNextPage())-->
		<!--@if($page == $page_no)-->
			<strong>{$page_no}</strong> 
		<!--@else-->
			<a href="{getUrl('page',$page_no,'document_srl','','division',$division,'last_division',$last_division,'entry','')}">{$page_no}</a>
		<!--@end-->
	<!--@end-->
	<a href="{getUrl('page',$page_navigation->last_page,'document_srl','','division',$division,'last_division',$last_division,'entry','')}" class="nextEnd">{$lang->last_page}</a>
</div>

<script>
	// ì¼ë°˜ í™•ì¥ì ì„¤ì • ì €ì¥
	function saveExtensionSettings() {
		var checkboxes = document.querySelectorAll('.ext-checkbox:checked');
		var extensions = [];

		for(var i = 0; i < checkboxes.length; i++) {
			extensions.push(checkboxes[i].value);
		}

		if(!confirm('í™•ì¥ì ì„¤ì •ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
			return false;
		}

		var form = jQuery('<form></form>');
		form.append(jQuery('<input type="hidden" name="module" value="board_extend" />'));
		form.append(jQuery('<input type="hidden" name="act" value="procBoard_extendAdminSaveExtensions" />'));
		form.append(jQuery('<input type="hidden" name="module_srl" value="{$module_info->module_srl}" />'));
		
		for(var i = 0; i < extensions.length; i++) {
			form.append(jQuery('<input type="hidden" name="allowed_extensions[]" value="' + extensions[i] + '" />'));
		}

		jQuery.ajax({
			type: 'POST',
			url: request_uri,
			data: form.serialize(),
			dataType: 'json',
			success: function(data) {
				alert(data.message);
				if(data.error == '0' || data.error == 0) {
					location.reload();
				}
			},
			error: function() {
				alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
			}
		});

		return false;
	}

	// ë¯¸ë””ì–´ íŒŒì¼ ì„¤ì • ì €ì¥
	function saveMediaSettings() {
		var excludeMediaChecked = document.getElementById('excludeMedia').checked;
		
		// ë¯¸ë””ì–´ ì œì™¸ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ì €ì¥ ë¶ˆí•„ìš”
		if(excludeMediaChecked) {
			alert('ë¨¼ì € "ë¯¸ë””ì–´ íŒŒì¼ ì œì™¸" ì²´í¬ë¥¼ í•´ì œí•´ì£¼ì„¸ìš”.');
			return false;
		}

		var checkboxes = document.querySelectorAll('.media-checkbox');
		var excludedExtensions = [];

		// ì²´í¬ í•´ì œëœ í•­ëª©ë§Œ ì œì™¸ ëª©ë¡ì— ì¶”ê°€
		for(var i = 0; i < checkboxes.length; i++) {
			if(!checkboxes[i].checked) {
				excludedExtensions.push(checkboxes[i].value);
			}
		}

		if(!confirm('ë¯¸ë””ì–´ íŒŒì¼ ì„¤ì •ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
			return false;
		}

		var form = jQuery('<form></form>');
		form.append(jQuery('<input type="hidden" name="module" value="board_extend" />'));
		form.append(jQuery('<input type="hidden" name="act" value="procBoard_extendAdminSaveMediaExtensions" />'));
		form.append(jQuery('<input type="hidden" name="module_srl" value="{$module_info->module_srl}" />'));
		
		for(var i = 0; i < excludedExtensions.length; i++) {
			form.append(jQuery('<input type="hidden" name="excluded_media_extensions[]" value="' + excludedExtensions[i] + '" />'));
		}

		jQuery.ajax({
			type: 'POST',
			url: request_uri,
			data: form.serialize(),
			dataType: 'json',
			success: function(data) {
				alert(data.message);
				if(data.error == '0' || data.error == 0) {
					// exclude_media=N ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ì„œ ìƒˆë¡œê³ ì¹¨
					var currentUrl = new URL(window.location.href);
					currentUrl.searchParams.set('exclude_media', 'N');
					window.location.href = currentUrl.toString();
				}
			},
			error: function() {
				alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
			}
		});

		return false;
	}
</script>